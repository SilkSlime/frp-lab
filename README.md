# FRP mTLS LAB üõ°Ô∏è

–í —ç—Ç–æ–π –ª–∞–±–µ –º—ã —Å–æ–∑–¥–∞–¥–∏–º –∑–∞—â–∏—â–µ–Ω–Ω—ã–π —Ç—É–Ω–Ω–µ–ª—å –º–µ–∂–¥—É –¥–≤—É–º—è –º–∞—à–∏–Ω–∞–º–∏ —Å –ø–æ–º–æ—â—å—é **FRP (Fast Reverse Proxy)**. –ì–ª–∞–≤–Ω–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å –Ω–∞—à–µ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ ‚Äî –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ **–≤–∑–∞–∏–º–Ω—ã–π TLS (mTLS)**, –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π –∏–ª–∏ —Ç–æ–∫–µ–Ω–æ–≤.

**–û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å** ‚Äî –Ω–∞—É—á–∏—Ç—å—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ "–≤—ã—Å—Ç–∞–≤–ª—è—Ç—å" –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–µ—Ä–≤–∏—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –∑–∞ NAT –∏–ª–∏ —Ñ–∞–π—Ä–≤–æ–ª–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ–º–∞—à–Ω–∏–π –≤–µ–±-—Å–µ—Ä–≤–µ—Ä, IoT-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏–ª–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Å–µ—Ä–≤–∏—Å –∫–æ–º–ø–∞–Ω–∏–∏), –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞—è –ø—Ä–∏ —ç—Ç–æ–º –≤—Ö–æ–¥—è—â–∏–µ –ø–æ—Ä—Ç—ã –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞.

–ü–æ –∏—Ç–æ–≥–∞–º —ç—Ç–æ–π —Ä–∞–±–æ—Ç—ã –≤—ã:
*   –ü–æ–π–º–µ—Ç–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã mTLS –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∫–ª—é—á–µ–π (PKI).
*   –ü–æ–ª—É—á–∏—Ç–µ –≥–æ—Ç–æ–≤—ã–π –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —à–∞–±–ª–æ–Ω –Ω–∞ Docker Compose –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è.
*   –ù–∞—É—á–∏—Ç–µ—Å—å –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –¥–ª—è —Å–≤–æ–∏—Ö –Ω—É–∂–¥.
*   –ë—É–¥–µ—Ç–µ –≥–æ—Ç–æ–≤—ã –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –ø–æ–¥–æ–±–Ω–æ–π —Å—Ö–µ–º—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö.

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. [–°—Ö–µ–º–∞ —Å–µ—Ç–∏ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è](#1)
2. [–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è –º–∏–Ω—É—Ç–∫–∞](#2)
    - [–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–±—Ä–∞—Ç–Ω—ã–π –ø—Ä–æ–∫—Å–∏-—Ç—É–Ω–Ω–µ–ª—å (FRP)?](#3)
    - [–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã, CA –∏ –º–∞–≥–∏—è mTLS](#4)
3. [–ü—Ä–∞–∫—Ç–∏–∫–∞](#5)
    - [–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è](#6)
    - [–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#7)
    - [–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤](#8)
    - [–ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ (frps)](#9)
    - [–ó–∞–ø—É—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞ (frpc)](#10)
    - [–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏ —Ç—Ä–∞–±–ª—à—É—Ç–∏–Ω–≥](#11)
    - [–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–µ–Ω–¥–∞](#12)
4. [–î–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏](#13)
    - [–°–æ–≤–µ—Ç—ã –ø–æ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é](#14)
    - [–ì–∞–π–¥ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö](#15)
    - [–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã](#16)

<a id="1"></a>

## –°—Ö–µ–º–∞ —Å–µ—Ç–∏ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

–ú—ã –ø–æ—Å—Ç—Ä–æ–∏–º —Å—Ç–µ–Ω–¥, –∏–º–∏—Ç–∏—Ä—É—é—â–∏–π —Ä–µ–∞–ª—å–Ω—É—é —Å–∏—Ç—É–∞—Ü–∏—é: –µ—Å—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π —Å–µ—Ä–≤–µ—Ä (`frps`) –∏ –∫–ª–∏–µ–Ω—Ç (`frpc`), –Ω–∞—Ö–æ–¥—è—â–∏–π—Å—è –≤ –ø—Ä–∏–≤–∞—Ç–Ω–æ–π —Å–µ—Ç–∏.

**–õ–æ–≥–∏–∫–∞ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö:**

```mermaid
flowchart TB
    subgraph "–ò–Ω—Ç–µ—Ä–Ω–µ—Ç"
        direction LR
        browser["–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å<br>(–±—Ä–∞—É–∑–µ—Ä / curl)"] -- TCP-–∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ—Ä—Ç 9003 --> frps(frps<br>–ü—É–±–ª–∏—á–Ω—ã–π IP)
    end

    subgraph "–ü—Ä–∏–≤–∞—Ç–Ω–∞—è —Å–µ—Ç—å (–∑–∞ NAT)"
        direction LR
        frpc(frpc) -- "–ü—Ä–æ–∫—Å–∏—Ä—É–µ—Ç —Ç—Ä–∞—Ñ–∏–∫" --> backend(–õ–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å<br>echo-backend:8080)
    end

    frps -- "–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–∞—Ñ–∏–∫<br>–≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç—É–Ω–Ω–µ–ª—å" --> frpc
```

**–ü—Ä–æ—Ü–µ—Å—Å —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (TLS Handshake):**

```mermaid
sequenceDiagram
    participant C as frpc (–ö–ª–∏–µ–Ω—Ç)
    participant S as frps (–°–µ—Ä–≤–µ—Ä)

    Note over C,S: –û–±–∞ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –¥–æ–≤–µ—Ä—è—é—Ç –æ–¥–Ω–æ–º—É –∏ —Ç–æ–º—É –∂–µ<br>–ö–æ—Ä–Ω–µ–≤–æ–º—É –¶–µ–Ω—Ç—Ä—É –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (CA)

    C->>S: 1. TCP-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–∞ –ø–æ—Ä—Ç 7000
    S-->>C: 2. ServerHello + —Å–≤–æ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (server.crt)
    Note right of C: –ö–ª–∏–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:<br>1. –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ–¥–ø–∏—Å–∞–Ω –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–º CA.<br>2. –ò–º—è –≤ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–µ (SAN) —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å 'server'.
    C-->>S: 3. ClientHello + —Å–≤–æ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (client.crt)
    Note left of S: –°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:<br>1. –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ–¥–ø–∏—Å–∞–Ω –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–º CA.
    S-->>C: 4. TLS Handshake OK
    C->>S: 5. FRP Login (–≤–Ω—É—Ç—Ä–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞)
    S-->>C: 6. –¢—É–Ω–Ω–µ–ª—å –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!
```

<a id="2"></a>

## –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è –º–∏–Ω—É—Ç–∫–∞

<a id="3"></a>

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–±—Ä–∞—Ç–Ω—ã–π –ø—Ä–æ–∫—Å–∏-—Ç—É–Ω–Ω–µ–ª—å (FRP)?

–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–∫—Å–∏ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö "–≤–ø–µ—Ä–µ–¥" –∫ —Ü–µ–ª–µ–≤—ã–º —Å–µ—Ä–≤–µ—Ä–∞–º. **–û–±—Ä–∞—Ç–Ω—ã–π –ø—Ä–æ–∫—Å–∏** —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–æ–±–æ—Ä–æ—Ç. –ö–ª–∏–µ–Ω—Ç (`frpc`), –Ω–∞—Ö–æ–¥—è—â–∏–π—Å—è –≤ –∑–∞–∫—Ä—ã—Ç–æ–π —Å–µ—Ç–∏, —Å–∞–º –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç *–∏—Å—Ö–æ–¥—è—â–µ–µ* —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –ø—É–±–ª–∏—á–Ω—ã–º —Å–µ—Ä–≤–µ—Ä–æ–º (`frps`). –≠—Ç–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–º. –ö–æ–≥–¥–∞ –≤–Ω–µ—à–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ `frps` –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –ø–æ—Ä—Ç, `frps` –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç —ç—Ç–æ—Ç —Ç—Ä–∞—Ñ–∏–∫ "–Ω–∞–∑–∞–¥" –∫–ª–∏–µ–Ω—Ç—É `frpc` —á–µ—Ä–µ–∑ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ç—É–Ω–Ω–µ–ª—å.

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±–æ–π—Ç–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è NAT –∏ —Ñ–∞–π—Ä–≤–æ–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –æ–±—ã—á–Ω–æ –±–ª–æ–∫–∏—Ä—É—é—Ç –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.

<a id="4"></a>

### –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã, CA –∏ –º–∞–≥–∏—è mTLS

*   **TLS (Transport Layer Security):** –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª –∑–∞—â–∏—Ç—ã –¥–∞–Ω–Ω—ã—Ö –≤ —Å–µ—Ç–∏. –í 99% —Å–ª—É—á–∞–µ–≤ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π TLS: –≤–∞—à –±—Ä–∞—É–∑–µ—Ä (–∫–ª–∏–µ–Ω—Ç) –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤–µ–±-—Å–∞–π—Ç–∞ (—Å–µ—Ä–≤–µ—Ä–∞), —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ `google.com`, –∞ –Ω–µ —Ñ–∏—à–∏–Ω–≥–æ–≤—ã–π —Å–∞–π—Ç.

*   **mTLS (Mutual TLS):** –í–∑–∞–∏–º–Ω—ã–π TLS. –≠—Ç–æ –∫–∞–∫ –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –ø–∞—Å–ø–æ—Ä—Ç–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å. –ù–µ —Ç–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–µ—Ä–≤–µ—Ä, –Ω–æ –∏ **—Å–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞**. –ö–∞–∂–¥—ã–π —É—á–∞—Å—Ç–Ω–∏–∫ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–¥—ä—è–≤–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç, –∫–æ—Ç–æ—Ä–æ–º—É –¥–æ–≤–µ—Ä—è–µ—Ç –¥—Ä—É–≥–∞—è —Å—Ç–æ—Ä–æ–Ω–∞.

*   **–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (`.crt`):** –¶–∏—Ñ—Ä–æ–≤–æ–π "–ø–∞—Å–ø–æ—Ä—Ç". –°–æ–¥–µ—Ä–∂–∏—Ç –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–ª–∞–¥–µ–ª—å—Ü–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è `server` –∏–ª–∏ `client`).

*   **–ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á (`.key`):** –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á, –ø–∞—Ä–Ω—ã–π –∫ –ø—É–±–ª–∏—á–Ω–æ–º—É. –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ –º–æ–∂–µ—Ç –¥–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –æ–Ω —è–≤–ª—è–µ—Ç—Å—è –ª–µ–≥–∏—Ç–∏–º–Ω—ã–º –≤–ª–∞–¥–µ–ª—å—Ü–µ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞. **–ï–≥–æ —É—Ç–µ—á–∫–∞ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä—É–µ—Ç –≤—Å—é —Å–∏—Å—Ç–µ–º—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.**

*   **–¶–µ–Ω—Ç—Ä –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (CA - Certificate Authority):** –î–æ–≤–µ—Ä–µ–Ω–Ω—ã–π "–ø–∞—Å–ø–æ—Ä—Ç–Ω—ã–π —Å—Ç–æ–ª". CA –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á (`CA.key`) –¥–ª—è —Ü–∏—Ñ—Ä–æ–≤–æ–π –ø–æ–¥–ø–∏—Å–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ —Å–µ—Ä–≤–µ—Ä–æ–≤. –ö–æ–≥–¥–∞ `frps` –ø–æ–ª—É—á–∞–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –æ—Ç `frpc`, –æ–Ω –≤–∏–¥–∏—Ç –ø–æ–¥–ø–∏—Å—å –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: "–ê–≥–∞, —ç—Ç–æ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –ø–æ–¥–ø–∏—Å–∞–Ω —Ç–µ–º —Å–∞–º—ã–º CA, –∫–æ—Ç–æ—Ä–æ–º—É —è –¥–æ–≤–µ—Ä—è—é. –ó–Ω–∞—á–∏—Ç, –∫–ª–∏–µ–Ω—Ç '—Å–≤–æ–π'".

*   **–ü–æ—á–µ–º—É `CA.key` –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –≤ —Å—Ç—Ä–æ–∂–∞–π—à–µ–º —Å–µ–∫—Ä–µ—Ç–µ?**
    –ï—Å–ª–∏ –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ —É–∫—Ä–∞–¥–µ—Ç –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –≤–∞—à–µ–≥–æ CA, –æ–Ω —Å–º–æ–∂–µ—Ç –≤—ã–ø—É—Å—Ç–∏—Ç—å **–ª—é–±–æ–π –≤–∞–ª–∏–¥–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `evil_client.crt`). –í–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç –¥–æ–≤–µ—Ä—è—Ç—å —ç—Ç–æ–º—É —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –ø–æ–¥–ø–∏—Å–∞–Ω –ª–µ–≥–∏—Ç–∏–º–Ω—ã–º (—Ö–æ—Ç—å –∏ —É–∫—Ä–∞–¥–µ–Ω–Ω—ã–º) –∫–ª—é—á–æ–º. –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –∞—Ç–∞–∫—É—é—â–µ–º—É –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –≤–∞—à–µ–º—É —Å–µ—Ä–≤–µ—Ä—É –∏ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –≤–∞—à–∏–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º —Ä–µ—Å—É—Ä—Å–∞–º. **–ö–ª—é—á CA ‚Äî —ç—Ç–æ –∫–ª—é—á –æ—Ç –≤—Å–µ–≥–æ.**

<a id="5"></a>

## –ü—Ä–∞–∫—Ç–∏–∫–∞

<a id="6"></a>

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:

| –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç    | –í–µ—Ä—Å–∏—è                    | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                |
|---------------|---------------------------|-------------------------------------------|
| Docker Engine | ‚â• 23.0                    | –î–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (compose v2 –≤—Å—Ç—Ä–æ–µ–Ω) |
| OpenSSL       | ‚â• 1.1                     | –î–ª—è —Ä—É—á–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤         |
| Git           | –õ—é–±–∞—è                     | –î–ª—è –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è —Å –ª–∞–±–æ–π      |

<a id="7"></a>

### –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
git clone https://github.com/silkslime/frp-lab.git
cd frp-lab
```

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ—Å–ª–µ –≤—Å–µ—Ö —à–∞–≥–æ–≤ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:
```
.
‚îú‚îÄ‚îÄ frpgen                # –°–∫—Ä–∏–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
‚îú‚îÄ‚îÄ frps/
‚îÇ   ‚îú‚îÄ‚îÄ docker-compose.yml
‚îÇ   ‚îî‚îÄ‚îÄ frps.toml
‚îú‚îÄ‚îÄ frpc/
‚îÇ   ‚îú‚îÄ‚îÄ docker-compose.yml
‚îÇ   ‚îî‚îÄ‚îÄ frpc.toml
‚îî‚îÄ‚îÄ certs/                # –ü–∞–ø–∫–∞ –¥–ª—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ (–±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞)
    ‚îú‚îÄ‚îÄ FRP_CA.crt
    ‚îú‚îÄ‚îÄ FRP_CA.key
    ‚îú‚îÄ‚îÄ client/
    ‚îÇ   ‚îú‚îÄ‚îÄ client.crt
    ‚îÇ   ‚îî‚îÄ‚îÄ client.key
    ‚îî‚îÄ‚îÄ server/
        ‚îú‚îÄ‚îÄ server.crt
        ‚îî‚îÄ‚îÄ server.key
```

<a id="8"></a>

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

#### –°–ø–æ—Å–æ–± 1 (–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π): –° –ø–æ–º–æ—â—å—é —Å–∫—Ä–∏–ø—Ç–∞ `frpgen`

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç-–æ–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ OpenSSL –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ CA –∏ –ø–æ–¥–ø–∏—Å—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤.

```bash
# 1. –°–æ–∑–¥–∞–µ–º –ö–æ—Ä–Ω–µ–≤–æ–π –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (CA) –≤ –ø–∞–ø–∫–µ certs/
./frpgen root certs --overwrite

# 2. –°–æ–∑–¥–∞–µ–º –∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞ (CN=server)
./frpgen client certs/server --ca certs

# 3. –°–æ–∑–¥–∞–µ–º –∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ (CN=client)
./frpgen client certs/client --ca certs
```
*–ü—Ä–æ–≤–µ—Ä–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):* `frpgen check certs/server --ca certs` –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å `OK`.

#### –°–ø–æ—Å–æ–± 2 (–î–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è): –í—Ä—É—á–Ω—É—é —Å –ø–æ–º–æ—â—å—é OpenSSL
–≠—Ç–æ—Ç —Å–ø–æ—Å–æ–± –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–∫—Ä–∏–ø—Ç `frpgen` "–ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º". –û–Ω –ø–æ–ª–µ–∑–µ–Ω, –µ—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –¥–æ—Å–∫–æ–Ω–∞–ª—å–Ω–æ –ø–æ–Ω—è—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –∏–ª–∏ –µ—Å–ª–∏ —É –≤–∞—Å –Ω–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç.
<details>
<summary>–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Ä—É—á–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</summary>

##### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞: –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

```bash
mkdir -p certs/server certs/client
```

##### **–®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –ö–æ—Ä–Ω–µ–≤–æ–≥–æ –¶–µ–Ω—Ç—Ä–∞ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (CA)**

CA ‚Äî —ç—Ç–æ –æ—Å–Ω–æ–≤–∞ –¥–æ–≤–µ—Ä–∏—è –≤ –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ. –ú—ã —Å–æ–∑–¥–∞–¥–∏–º –µ–≥–æ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –∏ —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π –ø—É–±–ª–∏—á–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç.

1.  **–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á CA (4096 –±–∏—Ç):**
    ```bash
    openssl genrsa -out certs/FRP_CA.key 4096
    ```

2.  **–°–æ–∑–¥–∞–µ–º —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç CA (—Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è 10 –ª–µ—Ç):**
    ```bash
    openssl req -new -x509 \
      -key certs/FRP_CA.key \
      -sha256 -days 3650 \
      -subj "/CN=FRP" \
      -addext "basicConstraints=critical,CA:TRUE,pathlen:0" \
      -addext "keyUsage=critical,keyCertSign,cRLSign" \
      -out certs/FRP_CA.crt
    ```

> **–ß—Ç–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç? –†–∞–∑–±–æ—Ä –∫–ª—é—á–µ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:**
>
> *   `-subj "/CN=..."`: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `Common Name` (–æ–±—â–µ–µ –∏–º—è) –¥–ª—è –Ω–∞—à–µ–≥–æ CA.
> *   `-addext "basicConstraints=critical,CA:TRUE,pathlen:0"`: **–≠—Ç–æ —Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π —Ñ–ª–∞–≥.** –û–Ω –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –ø—Ä—è–º–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç:
>     *   `CA:TRUE`: –≠—Ç–æ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —è–≤–ª—è–µ—Ç—Å—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º –¶–µ–Ω—Ç—Ä–∞ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.
>     *   `critical`: –≠—Ç–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —è–≤–ª—è–µ—Ç—Å—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–º, –∏ –ª—é–±–∞—è —Å–∏—Å—Ç–µ–º–∞, –ø—Ä–æ–≤–µ—Ä—è—é—â–∞—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç, *–æ–±—è–∑–∞–Ω–∞* –µ–≥–æ –ø–æ–Ω–∏–º–∞—Ç—å –∏ —É—á–∏—Ç—ã–≤–∞—Ç—å.
>     *   `pathlen:0`: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –∑–∞–ø—Ä–µ—â–∞–µ—Ç —ç—Ç–æ–º—É CA —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ, –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ CA. –û–Ω –º–æ–∂–µ—Ç –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ–Ω–µ—á–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (–∫–∞–∫ –Ω–∞—à–∏ `server` –∏ `client`). –≠—Ç–æ —Ö–æ—Ä–æ—à–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
> *   `-addext "keyUsage=critical,keyCertSign,cRLSign"`: –£–∫–∞–∑—ã–≤–∞–µ—Ç, –¥–ª—è —á–µ–≥–æ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —ç—Ç–æ—Ç –∫–ª—é—á. `keyCertSign` ‚Äî —ç—Ç–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –ø–æ–¥–ø–∏—Å—å –¥—Ä—É–≥–∏—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤.

##### **–®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞ (frps)**

–¢–µ–ø–µ—Ä—å, –∏–º–µ—è —Å–≤–æ–π "–ø–∞—Å–ø–æ—Ä—Ç–Ω—ã–π —Å—Ç–æ–ª" (CA), –º—ã –º–æ–∂–µ–º –≤—ã–¥–∞—Ç—å "–ø–∞—Å–ø–æ—Ä—Ç" (—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç) –Ω–∞—à–µ–º—É —Å–µ—Ä–≤–µ—Ä—É.

1.  **–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞ (2048 –±–∏—Ç):**
    ```bash
    openssl genrsa -out certs/server/server.key 2048
    ```

2.  **–°–æ–∑–¥–∞–µ–º –ó–∞–ø—Ä–æ—Å –Ω–∞ –ü–æ–¥–ø–∏—Å—å –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ (CSR - Certificate Signing Request):**
    CSR ‚Äî —ç—Ç–æ "–∑–∞—è–≤–∫–∞" –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–ª–∞–¥–µ–ª—å—Ü–µ.
    ```bash
    openssl req -new -key certs/server/server.key \
      -subj "/CN=server" \
      -addext "subjectAltName=DNS:server" \
      -out certs/server/server.csr
    ```
    > **–í–∞–∂–Ω–æ:** –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º `-addext "subjectAltName=DNS:server"`. **SAN (Subject Alternative Name)** ‚Äî —ç—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è –∏–º–µ–Ω —Ö–æ—Å—Ç–æ–≤ –≤ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞—Ö. `Common Name` (CN) —Å—á–∏—Ç–∞–µ—Ç—Å—è —É—Å—Ç–∞—Ä–µ–≤—à–∏–º –¥–ª—è —ç—Ç–∏—Ö —Ü–µ–ª–µ–π.

3.  **–ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º CSR —Å –ø–æ–º–æ—â—å—é –Ω–∞—à–µ–≥–æ CA:**
    –ù–∞ —ç—Ç–æ–º —à–∞–≥–µ CA –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–ø—Ä–æ—Å –∏, –µ—Å–ª–∏ –≤—Å–µ –≤ –ø–æ—Ä—è–¥–∫–µ, –≤—ã–ø—É—Å–∫–∞–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç.
    ```bash
    openssl x509 -req -in certs/server/server.csr \
        -CA certs/FRP_CA.crt \
        -CAkey certs/FRP_CA.key \
        -CAcreateserial \
        -days 825 -sha256 \
        -copy_extensions copy \
        -out certs/server/server.crt
    ```
> **–†–∞–∑–±–æ—Ä –∫–ª—é—á–µ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:**
>
> *   `-CAcreateserial`: –°–æ–∑–¥–∞–µ—Ç —Ñ–∞–π–ª `FRP_CA.srl`. OpenSSL —Ç—Ä–µ–±—É–µ—Ç –≤–µ—Å—Ç–∏ "–∂—É—Ä–Ω–∞–ª" –≤—ã–¥–∞–Ω–Ω—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤, —Å–æ—Ö—Ä–∞–Ω—è—è –∏—Ö —Å–µ—Ä–∏–π–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ. –û–Ω –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ.
> *   `-copy_extensions copy`: **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–π —Ñ–ª–∞–≥!** –û–Ω –ø—Ä–∏–∫–∞–∑—ã–≤–∞–µ—Ç OpenSSL —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (–≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ ‚Äî `subjectAltName`) –∏–∑ CSR –≤ –∫–æ–Ω–µ—á–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç. **–ë–µ–∑ —ç—Ç–æ–≥–æ —Ñ–ª–∞–≥–∞ SAN –±—É–¥–µ—Ç —É—Ç–µ—Ä—è–Ω**, –∏ –∫–ª–∏–µ–Ω—Ç –Ω–µ —Å–º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–º—è —Å–µ—Ä–≤–µ—Ä–∞, —á—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –æ—à–∏–±–∫–µ TLS.

##### **–®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ (frpc)**

–ü—Ä–æ—Ü–µ—Å—Å –∞–±—Å–æ–ª—é—Ç–Ω–æ –∏–¥–µ–Ω—Ç–∏—á–µ–Ω —Å–æ–∑–¥–∞–Ω–∏—é —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞, –º–µ–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤ –∏ `CN`/`SAN`.

1.  **–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–ª—é—á –∫–ª–∏–µ–Ω—Ç–∞:**
    ```bash
    openssl genrsa -out certs/client/client.key 2048
    ```

2.  **–°–æ–∑–¥–∞–µ–º CSR –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞:**
    ```bash
    openssl req -new -key certs/client/client.key \
      -subj "/CN=client" \
      -addext "subjectAltName=DNS:client" \
      -out certs/client/client.csr
    ```

3.  **–ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º CSR –∫–ª–∏–µ–Ω—Ç–∞ —Å –ø–æ–º–æ—â—å—é CA:**
    ```bash
    openssl x509 -req -in certs/client/client.csr \
      -CA certs/FRP_CA.crt \
      -CAkey certs/FRP_CA.key \
      -CAcreateserial \
      -days 825 -sha256 \
      -copy_extensions copy \
      -out certs/client/client.crt
    ```
    *–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –º—ã –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–ª–∞–≥ `-CAcreateserial`. OpenSSL –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–∏—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ–∞–π–ª `FRP_CA.srl` –Ω–æ–≤—ã–º —Å–µ—Ä–∏–π–Ω—ã–º –Ω–æ–º–µ—Ä–æ–º.*

##### **–®–∞–≥ 4: –û—á–∏—Å—Ç–∫–∞ (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**

–§–∞–π–ª—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –ø–æ–¥–ø–∏—Å—å (`.csr`) –±—ã–ª–∏ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–º–∏ –∏ –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω—ã. –ò—Ö –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ —É–¥–∞–ª–∏—Ç—å.

```bash
rm certs/server/server.csr certs/client/client.csr
```

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–∏—Ö —à–∞–≥–æ–≤ —É –≤–∞—Å –±—É–¥–µ—Ç —Ç–æ—á–Ω–æ —Ç–∞–∫–∞—è –∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –≤ –ø–∞–ø–∫–µ `certs`, –∫–∞–∫ –∏ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Å–∫—Ä–∏–ø—Ç–∞ `frpgen`, –Ω–æ —Ç–µ–ø–µ—Ä—å –≤—ã –∑–Ω–∞–µ—Ç–µ, –∫–∞–∫ –∏ –ø–æ—á–µ–º—É —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∂–¥–∞—è –∫–æ–º–∞–Ω–¥–∞.


</details>

<a id="9"></a>

### –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ (frps)

–ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å–µ—Ä–≤–µ—Ä–∞ –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –µ–≥–æ.

```bash
cd frps
docker compose up -d
```

–ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä —É—Å–ø–µ—à–Ω–æ —Å—Ç–∞—Ä—Ç–æ–≤–∞–ª:
```bash
docker compose logs -f
# –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
# frps-1  | [I] [frps/root.go:114] frps started successfully
```

**–†–∞–∑–±–æ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `frps.toml`:**
```toml
# frps.toml
bindPort = 7000                      # –ü–æ—Ä—Ç –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ (frpc).

# --- –°–µ–∫—Ü–∏—è TLS ---
transport.tls.force = true           # –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û. –ó–∞–ø—Ä–µ—â–∞–µ—Ç –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.
# –ü—É—Ç—å –∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É –∏ –∫–ª—é—á—É —Å–µ—Ä–≤–µ—Ä–∞ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
transport.tls.certFile = "/etc/frp/certs/frps.crt"
transport.tls.keyFile = "/etc/frp/certs/frps.key"
# –ü—É—Ç—å –∫ –ø—É–±–ª–∏—á–Ω–æ–º—É —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É –Ω–∞—à–µ–≥–æ CA. –ò–º —Å–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤.
transport.tls.trustedCaFile = "/etc/frp/certs/FRP_CA.crt"

# --- –ü–æ–ª–∏—Ç–∏–∫–∏ ---
# –°–ø–∏—Å–æ–∫ –ø–æ—Ä—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –º–æ–≥—É—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –¥–ª—è –ø—Ä–æ–∫—Å–∏.
allowPorts = [
  { single = 9003 },
  { start = 9050, end = 9100 }
]

# --- –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (Dashboard) ---
webServer.addr = "0.0.0.0"
webServer.port = 7500
webServer.user = "admin"
webServer.pass = "admin"
```

<a id="10"></a>

### –ó–∞–ø—É—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞ (frpc)

–¢–µ–ø–µ—Ä—å –∑–∞–ø—É—Å–∫–∞–µ–º –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Å—Ç–µ–∫, –∫–æ—Ç–æ—Ä—ã–π –≤–∫–ª—é—á–∞–µ—Ç `frpc` –∏ —Ç–µ—Å—Ç–æ–≤—ã–π `echo-backend`.

```bash
cd ../frpc
docker compose up -d
```

**–†–∞–∑–±–æ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `frpc.toml`:**
```toml
# frpc.toml
serverAddr = "frps"                  # DNS-–∏–º—è —Å–µ—Ä–≤–µ—Ä–∞. Docker Compose –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑—Ä–µ—à–∏—Ç –µ–≥–æ –≤ IP –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ frps.
serverPort = 7000

# --- –°–µ–∫—Ü–∏—è TLS ---
transport.tls.enable = true
# –ò–º—è —Ö–æ—Å—Ç–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞. –î–û–õ–ñ–ù–û –°–û–í–ü–ê–î–ê–¢–¨ —Å SAN/CN –≤ server.crt.
transport.tls.serverName = "server"
# –ü—É—Ç–∏ –∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º –∫–ª–∏–µ–Ω—Ç–∞ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
transport.tls.certFile = "/etc/frp/certs/frpc.crt"
transport.tls.keyFile = "/etc/frp/certs/frpc.key"
# –ü—É—Ç—å –∫ CA, –∫–æ—Ç–æ—Ä—ã–º –∫–ª–∏–µ–Ω—Ç –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–µ—Ä–≤–µ—Ä–∞.
transport.tls.trustedCaFile = "/etc/frp/certs/FRP_CA.crt"

# --- –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–∫—Å–∏ ---
[[proxies]]
name = "echo-service-via-mtls"       # –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è –ø—Ä–æ–∫—Å–∏
type = "tcp"                         # –¢–∏–ø –ø—Ä–æ–∫—Å–∏ (–º–æ–∂–µ—Ç –±—ã—Ç—å http, https, udp –∏ —Ç.–¥.)
localIP = "backend"                  # DNS-–∏–º—è —Å–µ—Ä–≤–∏—Å–∞, –∫–æ—Ç–æ—Ä—ã–π –º—ã —Ö–æ—Ç–∏–º –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å
localPort = 8080                     # –ü–æ—Ä—Ç —ç—Ç–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
remotePort = 9003                    # –ü–æ—Ä—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –æ—Ç–∫—Ä—ã—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ FRPS
```

<a id="11"></a>

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏ —Ç—Ä–∞–±–ª—à—É—Ç–∏–Ω–≥

1.  **–ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø –∫ –Ω–∞—à–µ–º—É —Å–µ—Ä–≤–∏—Å—É —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä `frps`:**
    ```bash
    curl http://127.0.0.1:9003
    ```
    –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å JSON-–æ—Ç–≤–µ—Ç –æ—Ç `echo-backend`, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–∞—à–µ–º HTTP-–∑–∞–ø—Ä–æ—Å–µ.

2.  **–û—Ç–∫—Ä—ã–≤–∞–µ–º Dashboard —Å–µ—Ä–≤–µ—Ä–∞:**
    –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –ø–æ –∞–¥—Ä–µ—Å—É `http://127.0.0.1:7500`.
    *   **–õ–æ–≥–∏–Ω:** `admin`
    *   **–ü–∞—Ä–æ–ª—å:** `admin`
    –í —Ä–∞–∑–¥–µ–ª–µ **Proxies -> TCP** –≤—ã —É–≤–∏–¥–∏—Ç–µ –≤–∞—à `echo-service-via-mtls` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `online`.

**–ß—Ç–æ –µ—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç? (–¢—Ä–∞–±–ª—à—É—Ç–∏–Ω–≥)**

*   **–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ `docker compose -f frps/docker-compose.yml logs -f`.
    *   `remote error: tls: bad certificate`: –°–∞–º–∞—è —á–∞—Å—Ç–∞—è –æ—à–∏–±–∫–∞. –û–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –Ω–µ —Å–º–æ–≥ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∫–ª–∏–µ–Ω—Ç–∞. –ü—Ä–∏—á–∏–Ω—ã:
        1.  –ö–ª–∏–µ–Ω—Ç –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–ª —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç.
        2.  –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–µ —Ç–µ–º CA (`trustedCaFile`).
        3.  –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∫–ª–∏–µ–Ω—Ç–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω.
*   **–ö–ª–∏–µ–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∫–ª–∏–µ–Ω—Ç–∞ `docker compose -f frpc/docker-compose.yml logs -f`.
    *   `tls: failed to verify certificate: x509: certificate is not valid for any names, but wanted to match server`: –û—à–∏–±–∫–∞ –≤ `transport.tls.serverName` –≤ `frpc.toml`. –û–Ω–æ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å `DNS:server` –≤ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞.
*   **`curl` –≤—ã–¥–∞–µ—Ç `connection refused`:**
    1.  –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–±–∞ —Å—Ç–µ–∫–∞ (`frps` –∏ `frpc`) –∑–∞–ø—É—â–µ–Ω—ã (`docker ps`).
    2.  –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ –ª–æ–≥–∞—Ö `frps` –∏ `frpc` —É—Å—Ç–∞–Ω–æ–≤–∏–ª–æ—Å—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.
    3.  –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ—Ä—Ç `9003` –≤ `frpc.toml` (`remotePort`) —Ä–∞–∑—Ä–µ—à–µ–Ω –≤ `allowPorts` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

<a id="12"></a>

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–µ–Ω–¥–∞

–ß—Ç–æ–±—ã –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ —É–¥–∞–ª–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –∏–º–∏ —Ç–æ–º–∞ (volumes) –∏ —Å–µ—Ç–∏, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏ —É–¥–∞–ª—è–µ–º –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Å—Ç–µ–∫
docker compose -f frpc/docker-compose.yml down -v

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏ —É–¥–∞–ª—è–µ–º —Å–µ—Ä–≤–µ—Ä–Ω—ã–π —Å—Ç–µ–∫
docker compose -f frps/docker-compose.yml down -v

# –£–¥–∞–ª—è–µ–º –æ–±—â—É—é —Å–µ—Ç—å (–µ—Å–ª–∏ –æ–Ω–∞ –æ—Å—Ç–∞–ª–∞—Å—å)
docker network rm frp-lab_frpnet
```

<a id="13"></a>

## –î–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏

–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã —É—Å–ø–µ—à–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É–ª–∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ç—É–Ω–Ω–µ–ª—å —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –ø–æ mTLS. –¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –Ω–∞–¥–µ–∂–Ω—ã–π —à–∞–±–ª–æ–Ω, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á.

<a id="14"></a>

### –°–æ–≤–µ—Ç—ã –ø–æ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

#### –•—Ä–∞–Ω–µ–Ω–∏–µ —á–∞—Å—Ç–µ–π .toml –∫–æ–Ω—Ñ–∏–≥–∞ –≤ ENV

–ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∏ –∏ —Ç–æ–∫–µ–Ω—ã –≤ —Ñ–∞–π–ª–∞—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ Git. FRP –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —à–∞–±–ª–æ–Ω–∏–∑–∞—Ü–∏—é –∫–æ–Ω—Ñ–∏–≥–æ–≤.

**–ü—Ä–∏–º–µ—Ä:**
–í `frps.toml` –º–µ–Ω—è–µ–º `webServer.pass`:
```toml
webServer.pass = "{{ .Envs.FRP_DASHBOARD_PASS }}"
```
–í `frps/docker-compose.yml` –¥–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```yaml
services:
  frps:
    # ...
    environment:
      - FRP_DASHBOARD_PASS=mySuperSecretPassword123
```
–¢–µ–ø–µ—Ä—å –ø–∞—Ä–æ–ª—å –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —á–µ—Ä–µ–∑ —Å–µ–∫—Ä–µ—Ç—ã Docker/Kubernetes –∏–ª–∏ CI/CD.

#### –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è: mTLS + Token

mTLS ‚Äî —ç—Ç–æ —Ñ–∞–∫—Ç–æ—Ä "—Ç–æ, —á—Ç–æ —É —Ç–µ–±—è –µ—Å—Ç—å" (–ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á). –î–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞—â–∏—Ç—ã –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∞–∫—Ç–æ—Ä "—Ç–æ, —á—Ç–æ —Ç—ã –∑–Ω–∞–µ—à—å" (—Ç–æ–∫–µ–Ω).

–î–æ–±–∞–≤—å—Ç–µ –≤ `frps.toml` –∏ `frpc.toml`:
```toml
# frps.toml
auth.method = "token"
auth.token = "YOUR_SHARED_SECRET_TOKEN"

# frpc.toml
auth.method = "token"
auth.token = "YOUR_SHARED_SECRET_TOKEN"
```
–¢–µ–ø–µ—Ä—å –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç—É –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –∏ –≤–∞–ª–∏–¥–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç, –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω.

<a id="15"></a>

### –ì–∞–π–¥ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö

1.  **–°–µ—Ä–≤–µ—Ä (`frps`):**
    *   –ê—Ä–µ–Ω–¥—É–π—Ç–µ VPS —Å –ø—É–±–ª–∏—á–Ω—ã–º "–±–µ–ª—ã–º" IP-–∞–¥—Ä–µ—Å–æ–º.
    *   (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è, –Ω–∞–ø—Ä–∏–º–µ—Ä `frp.yourdomain.com`, –∏ –Ω–∞–ø—Ä–∞–≤—å—Ç–µ –µ–≥–æ –Ω–∞ IP –≤–∞—à–µ–≥–æ VPS.
    *   –ü—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞ —É–∫–∞–∂–∏—Ç–µ —ç—Ç–æ –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è –≤ SAN: `DNS:frp.yourdomain.com`.
    *   –í —Ñ–∞–π—Ä–≤–æ–ª–µ —Å–µ—Ä–≤–µ—Ä–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ –ø–æ—Ä—Ç—ã: `bindPort` (–Ω–∞–ø—Ä–∏–º–µ—Ä, 7000/tcp) –∏ `remotePort`'—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –±—É–¥–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, 9003/tcp).
2.  **–ö–ª–∏–µ–Ω—Ç (`frpc`):**
    *   –í `frpc.toml` –∏–∑–º–µ–Ω–∏—Ç–µ `serverAddr` –Ω–∞ –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è –∏–ª–∏ IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞.
    *   –ò–∑–º–µ–Ω–∏—Ç–µ `transport.tls.serverName` –Ω–∞ –≤–∞—à–µ –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è, —á—Ç–æ–±—ã –æ–Ω–æ —Å–æ–≤–ø–∞–¥–∞–ª–æ —Å SAN —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞.
3.  **–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ:**
    *   –í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ—Ç –∂–µ Docker Compose, –Ω–æ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–ø—É—Å–∫–∞—Ç—å `frps` –∏ `frpc` –∫–∞–∫ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–ª—É–∂–±—ã (systemd). –ì–æ—Ç–æ–≤—ã–µ unit-—Ñ–∞–π–ª—ã –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ FRP.

<a id="16"></a>

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

*   **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è FRP:** [https://gofrp.org/](https://gofrp.org/)
*   **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π FRP –Ω–∞ GitHub:** [https://github.com/fatedier/frp](https://github.com/fatedier/frp)
*   **–ü–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ SAN vs CN:** [Stack Overflow: Is Common Name deprecated?](https://stackoverflow.com/questions/59353608/is-cn-common-name-deprecated-in-favor-of-subject-alternative-name)
*   **–ü—Ä–æ—Ç–æ–∫–æ–ª—ã KCP –∏ QUIC:** FRP –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º—É–ª—å—Ç–∏–ø–ª–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–µ—Ä–µ–¥–∞—á—É –¥–∞–Ω–Ω—ã—Ö –ø–æ–≤–µ—Ä—Ö UDP (KCP, QUIC) –¥–ª—è —Å–µ—Ç–µ–π —Å –±–æ–ª—å—à–æ–π –ø–æ—Ç–µ—Ä–µ–π –ø–∞–∫–µ—Ç–æ–≤. –≠—Ç–æ –º–æ–∂–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç—É–Ω–Ω–µ–ª—è.

---
**Happy Tunnelling! üöÄ**